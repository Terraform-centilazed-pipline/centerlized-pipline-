# .terrateam/config.yml (centralized pipeline repo)

# enable the repo indexer so Terrateam discovers modules and dependencies
indexer:
  enabled: true

# dirs maps directories to workspaces and when they should be triggered
dirs:
  # top-level repo directory: you can map specific subdirs if you want
  .:
    when_modified:
      # adjust these patterns to match your repo layout
      file_patterns:
        - "${DIR}/**/*.tf"
        - "${DIR}/**/*.tfvars"
        - "modules/**"

# run OPA policy validation before plan (pre-plan hook)
hooks:
  plan:
    pre:
      - type: run
        # run your OPA validation script; adjust path as required
        cmd: ["bash", "./scripts/opa-validate.sh"]

# optional: use a simple workflow that explicitly runs init/plan/apply
workflows:
  - tag_query: ""   # apply to all workspaces
    plan:
      - type: init
      - type: plan
    apply:
      - type: init
      - type: apply
