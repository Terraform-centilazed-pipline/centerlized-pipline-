==============================================================================
GITHUB APP PERMISSIONS - EXACT REQUIREMENTS
==============================================================================

APP NAME: Terraform-Controller

WEBHOOK: ❌ DISABLED (we don't use webhooks!)

PERMISSIONS REQUIRED (Repository level):
--------------------------------------------
✅ Actions: Read and write
✅ Contents: Read and write  
✅ Issues: Read and write
✅ Pull requests: Read and write
✅ Workflows: Read and write
✅ Metadata: Read-only (auto-selected)

ALL OTHER PERMISSIONS: ❌ NO

SUBSCRIBE TO EVENTS:
--------------------------------------------
❌ NONE (uncheck all - we don't use webhooks)

INSTALL ON:
--------------------------------------------
✅ centerlized-pipline- (controller)
✅ dev-deployment (or your dev repos)
✅ OPA-Poclies (policies)
✅ tf-module (modules)

SECRETS TO ADD:
--------------------------------------------

In Controller Repo (centerlized-pipline-):
  • GITHUB_APP_ID=123456
  • GITHUB_APP_PRIVATE_KEY=<full .pem content>
  • AWS_TERRAFORM_ROLE_ARN=arn:aws:iam::xxx:role/xxx

In Dev Repos (dev-deployment, etc.):
  • GITHUB_APP_PRIVATE_KEY=<full .pem content>
  • AWS_TERRAFORM_ROLE_ARN=arn:aws:iam::xxx:role/xxx

==============================================================================
WHY EACH PERMISSION:
==============================================================================

Actions: Read and write
  → Trigger controller workflow from dev repo
  → Read workflow run status

Contents: Read and write
  → Clone source repos
  → Read terraform configurations
  → Access modules and policies

Issues: Read and write
  → Create issues when OPA fails
  → Track policy violations

Pull requests: Read and write
  → Post plan comments to PRs
  → Auto-merge PRs when OPA passes
  → Auto-close PRs when OPA fails

Workflows: Read and write
  → Call controller workflow via workflow_call
  → Trigger workflows programmatically

==============================================================================
WHAT WE DON'T NEED:
==============================================================================

❌ Webhooks - Using workflow_call instead
❌ Lambda/Cloud Run - Pure GitHub Actions
❌ External server - Everything in GitHub
❌ Admin permissions - Too risky
❌ Secrets access - Not needed
❌ Deployment permissions - Not needed
❌ Environment permissions - Not needed

==============================================================================
SECURITY:
==============================================================================

✅ Minimum required permissions only
✅ No admin access
✅ Private key stored in GitHub Secrets (encrypted)
✅ Tokens expire after 1 hour (auto-refresh)
✅ Audit logs for all actions
✅ Can be scoped to specific repos

==============================================================================
