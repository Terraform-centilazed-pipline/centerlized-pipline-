╔══════════════════════════════════════════════════════════════════════════════╗
║                     GITHUB SECRETS QUICK REFERENCE                           ║
╚══════════════════════════════════════════════════════════════════════════════╝

┌──────────────────────────────────────────────────────────────────────────────┐
│ STEP 1: CREATE GITHUB APP                                                   │
└──────────────────────────────────────────────────────────────────────────────┘

  URL: https://github.com/organizations/Terraform-centilazed-pipline/settings/apps

  Name: terraform-centralized-controller
  Webhook: ❌ DISABLED (uncheck "Active")
  
  Permissions (all "Read and write"):
    ✅ Actions
    ✅ Contents
    ✅ Issues
    ✅ Pull requests
    ✅ Workflows

  After creation:
    1. Generate private key (downloads .pem file)
    2. Copy App ID (shown at top of page)
    3. Install on 4 repos: centerlized-pipline-, dev-deployment, 
                           tf-module, OPA-Poclies

┌──────────────────────────────────────────────────────────────────────────────┐
│ STEP 2: ADD SECRETS TO CONTROLLER REPO                                      │
└──────────────────────────────────────────────────────────────────────────────┘

  Repo: centerlized-pipline-
  URL:  https://github.com/Terraform-centilazed-pipline/centerlized-pipline-/settings/secrets/actions

  ┌────────────────────────────────────────────────────────────────────────────┐
  │ Secret 1: GITHUB_APP_ID                                                    │
  ├────────────────────────────────────────────────────────────────────────────┤
  │ Value: 123456  (your actual App ID number)                                 │
  └────────────────────────────────────────────────────────────────────────────┘

  ┌────────────────────────────────────────────────────────────────────────────┐
  │ Secret 2: GITHUB_APP_PRIVATE_KEY                                           │
  ├────────────────────────────────────────────────────────────────────────────┤
  │ Value: -----BEGIN RSA PRIVATE KEY-----                                     │
  │        MIIEpAIBAAKCAQEA...                                                  │
  │        (entire .pem file contents)                                         │
  │        ...                                                                 │
  │        -----END RSA PRIVATE KEY-----                                       │
  └────────────────────────────────────────────────────────────────────────────┘

  ┌────────────────────────────────────────────────────────────────────────────┐
  │ Secret 3: AWS_TERRAFORM_ROLE_ARN                                           │
  ├────────────────────────────────────────────────────────────────────────────┤
  │ Value: arn:aws:iam::802860742843:role/TerraformExecutionRole              │
  └────────────────────────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────────────────────────┐
│ STEP 3: ADD SECRETS TO DEVELOPER REPO                                       │
└──────────────────────────────────────────────────────────────────────────────┘

  Repo: dev-deployment
  URL:  https://github.com/Terraform-centilazed-pipline/dev-deployment/settings/secrets/actions

  ┌────────────────────────────────────────────────────────────────────────────┐
  │ Secret 1: GITHUB_APP_PRIVATE_KEY                                           │
  ├────────────────────────────────────────────────────────────────────────────┤
  │ Value: -----BEGIN RSA PRIVATE KEY-----                                     │
  │        (same .pem file as controller repo)                                 │
  │        -----END RSA PRIVATE KEY-----                                       │
  └────────────────────────────────────────────────────────────────────────────┘

  ┌────────────────────────────────────────────────────────────────────────────┐
  │ Secret 2: AWS_TERRAFORM_ROLE_ARN                                           │
  ├────────────────────────────────────────────────────────────────────────────┤
  │ Value: arn:aws:iam::802860742843:role/TerraformExecutionRole              │
  │        (same value as controller repo)                                     │
  └────────────────────────────────────────────────────────────────────────────┘

┌──────────────────────────────────────────────────────────────────────────────┐
│ SUMMARY TABLE                                                                │
└──────────────────────────────────────────────────────────────────────────────┘

  ┌─────────────────────────┬──────────────┬─────────────────┬────────────────┐
  │ Secret Name             │ Controller   │ Dev Deployment  │ Value From     │
  ├─────────────────────────┼──────────────┼─────────────────┼────────────────┤
  │ GITHUB_APP_ID           │      ✅      │       ❌        │ GitHub App     │
  │ GITHUB_APP_PRIVATE_KEY  │      ✅      │       ✅        │ .pem file      │
  │ AWS_TERRAFORM_ROLE_ARN  │      ✅      │       ✅        │ AWS IAM        │
  └─────────────────────────┴──────────────┴─────────────────┴────────────────┘

┌──────────────────────────────────────────────────────────────────────────────┐
│ VERIFICATION CHECKLIST                                                       │
└──────────────────────────────────────────────────────────────────────────────┘

  GitHub App:
    □ App created
    □ Private key generated and saved
    □ App ID noted
    □ Installed on 4 repositories
    □ All 5 permissions set to "Read and write"

  Controller Repo (centerlized-pipline-):
    □ GITHUB_APP_ID added
    □ GITHUB_APP_PRIVATE_KEY added
    □ AWS_TERRAFORM_ROLE_ARN added

  Developer Repo (dev-deployment):
    □ GITHUB_APP_PRIVATE_KEY added
    □ AWS_TERRAFORM_ROLE_ARN added

  AWS:
    □ TerraformExecutionRole exists
    □ Trust policy configured for GitHub OIDC
    □ Permissions for S3, KMS, IAM operations

┌──────────────────────────────────────────────────────────────────────────────┐
│ TESTING                                                                      │
└──────────────────────────────────────────────────────────────────────────────┘

  Test 1: Create a PR in dev-deployment
    1. Edit a file in Accounts/**/*.tfvars
    2. Create a Pull Request
    3. Check Actions tab - workflow should trigger

  Test 2: Check workflow logs
    □ "Generate GitHub App Token" step succeeds
    □ All 4 repos checkout successfully
    □ Terraform init succeeds
    □ OPA validation runs

┌──────────────────────────────────────────────────────────────────────────────┐
│ COMMON ERRORS                                                                │
└──────────────────────────────────────────────────────────────────────────────┘

  ❌ "Resource not accessible by integration"
     → Check GitHub App permissions (all 5 must be "Read and write")

  ❌ "Bad credentials"
     → Re-copy entire .pem file including BEGIN/END lines

  ❌ "Invalid App ID"
     → Check App ID is just the number, no letters

  ❌ "AssumeRole failed"
     → Verify AWS role ARN is correct
     → Check trust policy allows GitHub OIDC

┌──────────────────────────────────────────────────────────────────────────────┐
│ IMPORTANT NOTES                                                              │
└──────────────────────────────────────────────────────────────────────────────┘

  • The .pem file should be copied EXACTLY as-is
  • Don't add any spaces or newlines to the private key
  • App ID is just the number (e.g., 123456), not the app name
  • Same GITHUB_APP_PRIVATE_KEY used in both repos
  • Same AWS_TERRAFORM_ROLE_ARN used in both repos
  • GitHub App ID only needed in controller repo

┌──────────────────────────────────────────────────────────────────────────────┐
│ NEED HELP?                                                                   │
└──────────────────────────────────────────────────────────────────────────────┘

  Detailed guide: GITHUB-SECRETS-SETUP.md
  GitHub App setup: GITHUB-APP-SETUP.md
  AWS IAM setup: OPA-Poclies/AWS-IAM-SETUP-GUIDE.md

╔══════════════════════════════════════════════════════════════════════════════╗
║                             END OF REFERENCE                                 ║
╚══════════════════════════════════════════════════════════════════════════════╝
